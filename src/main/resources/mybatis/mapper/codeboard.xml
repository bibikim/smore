<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.gdu.smore.mapper.CodeBoardMapper">

	<select id="selectCodeBoardListCount" resultType="int">
		SELECT COUNT(*)
		  FROM C_BOARD
	</select>
	
	<insert id="insertCodeBoard" parameterType="CodeBoardDTO">
		INSERT INTO C_BOARD
			(CO_NO, NICKNAME, TITLE, CONTENT, CREATE_DATE, MODIFY_DATE, HIT, IP)
		VALUES
			(#{coNo}, #{nickname}, #{title}, #{content}, NOW(), NOW(), 0, #{ip})
	</insert>
	
	<update id="updateHit" parameterType="int">
		UPDATE C_BOARD
		   SET HIT = HIT + 1
		 WHERE CO_NO = #{coNo}
	</update>
	
	<select id="selectCodeBoardByNo" parameterType="int" resultType="CodeBoardDTO">
		SELECT CO_NO as coNo, U.NICKNAME as nickname, TITLE as title, CONTENT as content, CREATE_DATE as createDate, MODIFY_DATE as modifyDate, HIT as hit, IP as ip
          FROM USERS U INNER JOIN C_BOARD C
            ON U.NICKNAME = C.NICKNAME
		 WHERE C.CO_NO = #{coNo}
	</select>
	
	<update id="updateCodeBoard" parameterType="CodeBoardDTO">
		UPDATE C_BOARD
		   SET TITLE = #{title}
		     , CONTENT = #{content}
		     , MODIFY_DATE = NOW()
		 WHERE CO_NO = #{coNo}
	</update>
	
	<delete id="deleteCodeBoard" parameterType="int">
		DELETE
		  FROM C_BOARD
		 WHERE C_BOARD_NO = #{coNo}
	</delete>
	
	<select id="selectCodeBoardListByMap" parameterType="Map" resultType="hashmap">
		SELECT A.ROW_NUM, A.CO_NO, A.NICKNAME, A.TITLE, A.CONTENT, A.CREATE_DATE, A.MODIFY_DATE, A.HIT, A.IP,
		CASE WHEN (A.CREATE_DATE >= CURDATE() - interval 1 DAY) THEN 'Y' ELSE 'N' END as NEW_YN
		  FROM (SELECT ROW_NUMBER() OVER(ORDER BY CO_NO DESC) AS ROW_NUM, B.CO_NO, B.NICKNAME, B.TITLE, B.CONTENT, B.CREATE_DATE, B.MODIFY_DATE, B.HIT, B.IP, U.USER_NO, U.ID, U.NAME
		          FROM USERS U INNER JOIN C_BOARD B
		            ON U.NICKNAME = B.NICKNAME) A
		 WHERE A.ROW_NUM BETWEEN #{begin} AND #{end}
	</select>
	
	
	
</mapper>
