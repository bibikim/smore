<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.gdu.smore.mapper.QnaBoardMapper">
	
	<select id="selectQnaBoardListCount" resultType="int">
		SELECT COUNT(*)
		  FROM Q_BOARD
	</select>
	
	<insert id="insertQnaBoard" parameterType="QnaBoardDTO">
		<selectKey keyProperty="qboardNo" resultType="int" order="BEFORE">
			SELECT QNABOARD_SEQ.NEXTVAL
			  FROM DUAL
		</selectKey>
		INSERT INTO QNABOARD
			(Q_NO, NICKNAME, TITLE, CONTENT, PW, CREATE_DATE, MODIFY_DATE, HIT, IP,)
		VALUES
			(#{qNo}, {#nickname}, #{title}, #{content}, #{pw}, SYSDATE, SYSDATE, 0, #{ip})
	</insert>
	
	<update id="updateHit" parameterType="int">
		UPDATE QNABOARD
		   SET HIT = HIT + 1
		 WHERE Q_NO = #{qNo}
	</update>
	
	<!-- <select id="selectQnaBoardByNo" parameterType="int" resultMap="QnaBoardDTO">
		SELECT Q.Q_NO, Q.NICKNAME, Q.TITLE, Q.CONTENT, Q.PW, Q.CREATE_DATE, Q.MODIFY_DATE, Q.HIT, Q.IP,
          FROM USERS U INNER JOIN QNABOARD Q
            ON U.USER_NO = Q.USER_NO
		 WHERE Q.Q_NO = #{qNo}
	</select> -->
	
	<update id="updateQnaBoard" parameterType="QnaBoardDTO">
		UPDATE QNABOARD
		   SET TITLE = #{title}
		     , CONTENT = #{content}
		     , MODIFY_DATE = SYSDATE
		 WHERE Q_NO = #{qNo}
	</update>
	
	<delete id="deleteQnaBoard" parameterType="int">
		DELETE
		  FROM QNABOARD
		 WHERE QNABOARD_NO = #{qNo}
	</delete>
	
	<select id="selectQnaBoardListByMap" parameterType="Map" resultType="hashmap">
		SELECT A.ROW_NUM, A.Q_NO, A.NICKNAME, A.Q_TITLE, A.Q_CONTENT, A.Q_PW, A.Q_CREATE_DATE, A.Q_MODIFY_DATE, A.Q_HIT, A.Q_IP,
		CASE WHEN A.Q_CREATE_DATE >= SYSDATE-7 THEN 'Y' ELSE 'N' END as NEW_YN
		  FROM (SELECT ROW_NUMBER() OVER(ORDER BY Q_NO DESC) AS ROW_NUM, B.Q_NO, B.NICKNAME, B.Q_TITLE, B.Q_CONTENT, B.Q_PW, B.Q_CREATE_DATE, B.Q_MODIFY_DATE, B.Q_HIT, B.Q_IP, U.USER_NO, U.ID, U.NAME
		          FROM USERS U INNER JOIN Q_BOARD B
		            ON U.USER_NO = B.Q_NO) A
		 WHERE A.ROW_NUM BETWEEN #{begin} AND #{end}
	</select>
	
	
	
	
</mapper>
	
	
	
	